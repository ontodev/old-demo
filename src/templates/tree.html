{% extends "base.html" %}
{% block content %}

{{ message|safe }}

<div class="row justify-content-md-center" style="padding-top:10px; padding-bottom:20px;">
  <div class="col-md-10">
  	<form method="post">
  		<div class="row g-3">
  			<div class="col-md-5">
          <select class="form-select form-select-sm" name="listName">
              <option selected>Select a list to add to</option>
              {% for list in lists %}
              <option value="{{list}}">{{ list }}</option>
              {% endfor %}
          </select>
  	     <div id="propertyHelp" class="form-text"><small>Don't see the list you want? Create one <a href="/export">here</a>.</small></div>
  	     </div>
  	        <div class="col-md-5">
  	            <div class="row">
  	                <label for="relatedEntityOptions" class="form-label">Also include...</label>
  	            </div>
  	            <div class="form-check form-check-inline" id="relatedEntityOptions">
  	                <input class="form-check-input" type="checkbox" name="relatedEntities" id="ancestors" value="ancestors">
  	                <label class="form-check-label" for="ancestors"><small>ancestors</small></label>
  	            </div>
  	            <div class="form-check form-check-inline">
  	                <input class="form-check-input" type="checkbox" name="relatedEntities" id="descendants" value="descendants">
  	                <label class="form-check-label" for="descendants"><small>descendants</small></label>
  	            </div>
  	            <div class="form-check form-check-inline">
  	                <input class="form-check-input" type="checkbox" name="relatedEntities" id="parents" value="parents">
  	                <label class="form-check-label" for="parents"><small>parents</small></label>
  	            </div>
  	            <div class="form-check form-check-inline">
  	                <input class="form-check-input" type="checkbox" name="relatedEntities" id="children" value="children">
  	                <label class="form-check-label" for="children"><small>children</small></label>
  	            </div>
  	        </div>
  	        <div class="col-md-2" style="padding-top:10px;">
  	        	<button type="submit" class="btn btn-primary">Add to List</button>
  	    	</div>
      	</div>
  	</form>
  	<div class="form-row mt-2 mb-2">
      	<input id="statements-typeahead" class="typeahead form-control" type="text" value="" placeholder="Search"></input>
      </div>
  </div>
</div>

<div class="row justify-content-md-center">
  <div class="col-md-10 tree">
    {{ tree|safe }}
  </div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
<script type="text/javascript">function show_children() {
hidden = $('#children li:hidden').slice(0, 100);
if (hidden.length > 1) {
    hidden.show();
    setTimeout(show_children, 100);
} else {
    console.log("DONE");
}
$('#more').hide();
}$('#search-form').submit(function () {
    $(this)
        .find('input[name]')
        .filter(function () {
            return !this.value;
        })
        .prop('name', '');
});
function jump(currentPage) {
  newPage = prompt("Jump to page", currentPage);
  if (newPage) {
    href = window.location.href.replace("page="+currentPage, "page="+newPage);
    window.location.href = href;
  }
}
function configure_typeahead(node) {
  if (!node.id || !node.id.endsWith("-typeahead")) {
    return;
  }
  table = node.id.replace("-typeahead", "");
  var bloodhound = new Bloodhound({
    datumTokenizer: Bloodhound.tokenizers.obj.nonword('display_name'),
    queryTokenizer: Bloodhound.tokenizers.nonword,
    sorter: function(a, b) {
      A = a.display_name.length;
      B = b.display_name.length;
      if (A < B) {
         return -1;
      }
      else if (A > B) {
         return 1;
      }
      else return 0;
    },
    remote: {
      url: '?text=%QUERY&format=json',
      wildcard: '%QUERY',
      transform : function(response) {
          return bloodhound.sorter(response);
      }
    }
  });
  $(node).typeahead({
    minLength: 0,
    hint: false,
    highlight: true
  }, {
    name: table,
    source: bloodhound,
    display: 'display_name',
    limit: 40
  });
  $(node).bind('click', function(e) {
    $(node).select();
  });
  $(node).bind('typeahead:select', function(ev, suggestion) {
    $(node).prev().val(suggestion.value);
    go(table, suggestion.value);
  });
  $(node).bind('keypress',function(e) {
    if(e.which == 13) {
      go(table, $('#' + table + '-hidden').val());
    }
  });
}
$('.typeahead').each(function() { configure_typeahead(this); });
function go(table, value) {
  q = {};
  table = table.replace('_all', '');
  q[table] = value;
  window.location = query(q);
}
function query(obj) {
  var str = [];
  for (var p in obj)
    if (obj.hasOwnProperty(p)) {
      return "./" + encodeURIComponent(obj[p]);
    }
}</script>

{% endblock %}